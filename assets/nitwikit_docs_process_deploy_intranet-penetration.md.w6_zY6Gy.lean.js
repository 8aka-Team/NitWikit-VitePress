import{_ as e,c as t,a5 as l,o as r}from"./chunks/framework.Dzz2jpra.js";const u=JSON.parse('{"title":"内网穿透","description":"","frontmatter":{"title":"内网穿透","sidebar_position":5},"headers":[],"relativePath":"nitwikit/docs/process/deploy/intranet-penetration.md","filePath":"nitwikit/docs/process/deploy/intranet-penetration.md","lastUpdated":1731202945000}'),i={name:"nitwikit/docs/process/deploy/intranet-penetration.md"};function n(o,a,p,s,c,h){return r(),t("div",null,a[0]||(a[0]=[l(`<h1 id="内网穿透" tabindex="-1">内网穿透 <a class="header-anchor" href="#内网穿透" aria-label="Permalink to &quot;内网穿透&quot;">​</a></h1><p><strong>适用于？</strong></p><p>没有公网的家里云</p><p><strong>来几个？</strong></p><p>内网穿透一抓一大把，比如<a href="https://www.natfrp.com/" target="_blank" rel="noreferrer">樱花内网穿透</a>和<a href="https://www.openfrp.net/" target="_blank" rel="noreferrer">OpenFrp</a></p><p>Cloudflare 有内网穿透 Tunnel (无需注册！),MineKube 也有内网穿透 Connect(同样无需注册)，还有 Geyser 官方推荐的 Playit.gg</p><p>Linux自建frp参见<a href="https://nitwikit.yizhan.wiki/advance/Linux/frp" target="_blank" rel="noreferrer">此页面</a></p><h2 id="cloudflare-tunnel" tabindex="-1">Cloudflare Tunnel <a class="header-anchor" href="#cloudflare-tunnel" aria-label="Permalink to &quot;Cloudflare Tunnel&quot;">​</a></h2><p><s>佛祖的东西肯定得介绍</s></p><p>Cloudflare Tunnel 是 CF 下的免费内网穿透</p><p>优点：</p><ul><li>免费，无需注册</li><li>自带 n TB高防</li><li>不限流</li><li>支持 TCP,UDP,RDP,SSH,HTTP</li><li>SSH 提供 WebSSH,还可以通过 Access 管理</li></ul><p>缺点：</p><ul><li>延迟较大(不可以优选）</li><li>客户端需安装 mod 才能进入(仅限 TCP,UDP)</li></ul><h3 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h3><p>在<a href="https://github.com/cloudflare/cloudflared/releases" target="_blank" rel="noreferrer">Github</a> 找到适合的版本并安装</p><h3 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to &quot;使用&quot;">​</a></h3><p>打开cmd,运行以下命令</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp://localhost:服务器端口</span></span></code></pre></div><p><code>tcp</code>可以换成其他你需要的协议，比如<code>http</code></p><p>很快你就能看到</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INF Thank you for trying Cloudflare Tunnel. Doing so, without a Cloudflare account, is a quick way to experiment and try it out. However, be aware that these account-less Tunnels have no uptime guarantee. If you intend to use Tunnels in production you should use a pre-created named tunnel by following: https://developers.cloudflare.com/cloudflare-one/connections/connect-apps</span></span>
<span class="line"><span>INF Requesting new quick Tunnel on trycloudflare.com...</span></span>
<span class="line"><span>INF +--------------------------------------------------------------------------------------------+</span></span>
<span class="line"><span>INF |  Your quick Tunnel has been created! Visit it at (it may take some time to be reachable):  |</span></span>
<span class="line"><span>INF |  https://corporate-mention-tiles-coordinates.trycloudflare.com                             |</span></span>
<span class="line"><span>INF +--------------------------------------------------------------------------------------------+</span></span></code></pre></div><p><code>*.trycloudflare.com</code> 就是 CF 给你的免费域名</p><h3 id="客户端" tabindex="-1">客户端 <a class="header-anchor" href="#客户端" aria-label="Permalink to &quot;客户端&quot;">​</a></h3><p>需要安装<a href="https://modrinth.com/mod/modflared" target="_blank" rel="noreferrer">Modflared</a></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>作为服主，你还需要绑定到你自己的域名，参考 Modflared 的教程</p></div><h2 id="minekube-connect" tabindex="-1">Minekube Connect <a class="header-anchor" href="#minekube-connect" aria-label="Permalink to &quot;Minekube Connect&quot;">​</a></h2><p>Minekube 的免费内网穿透,这个组织还有另一个有名作品 Gate</p><p>个人感觉比 Cloudflare Tunnel 强很多(比 Cloudflare Spectrum 体验都好)</p><p>优点：</p><ul><li>免费，无需注册</li><li>自带高防</li><li>不限流</li><li>会提供一个免费域名和1个 AnyCast 独立 IPV4</li><li>有 Dashboard,可以进行网络分流,管理,黑名单等操作</li></ul><p>缺点：</p><ul><li>延迟非常大</li></ul><p><a href="https://connect.minekube.com/" target="_blank" rel="noreferrer">官网</a></p><h2 id="playit-gg" tabindex="-1">Playit.gg <a class="header-anchor" href="#playit-gg" aria-label="Permalink to &quot;Playit.gg&quot;">​</a></h2><p>Playit 的免费内网穿透，需要登录</p><p>优点：</p><ul><li>提供免费版本</li><li>无限流量</li><li>提供防火墙功能</li><li>提供<strong>亚太地区节点</strong>（测试时候路由到了日本）</li><li>自带高防</li><li>支持 Geyser</li><li>支持任意TCP、UDP应用</li></ul><p>缺点：</p><ul><li>免费版本不能绑定自己的域名，只能使用随机域名</li><li>延迟略大</li></ul><p>Premium 版本一个月3刀(约合人民币27元)，一年30刀</p><h2 id="可能的问题" tabindex="-1">可能的问题? <a class="header-anchor" href="#可能的问题" aria-label="Permalink to &quot;可能的问题?&quot;">​</a></h2><p>内网穿透后相当于玩家的连接传递到了你机器上的软件上，用这个软件访问本地的服务端(类似代理)，服务端就会误认为是本地连接访问了服务器，就会出现以下问题：</p><h3 id="登录插件" tabindex="-1">登录插件 <a class="header-anchor" href="#登录插件" aria-label="Permalink to &quot;登录插件&quot;">​</a></h3><h4 id="玩家注册" tabindex="-1">玩家注册 <a class="header-anchor" href="#玩家注册" aria-label="Permalink to &quot;玩家注册&quot;">​</a></h4><p>支持 IP 限制注册账号的登录插件(如 Authme 、CMI )会出问题</p><p>如果内网穿透的话，他们的 IP 地址都是回环地址，所以他们不能注册账号了</p><h4 id="自动登录" tabindex="-1">自动登录 <a class="header-anchor" href="#自动登录" aria-label="Permalink to &quot;自动登录&quot;">​</a></h4><p>此功能依靠 IP 进行识别，如果内网穿透的话，普通玩家和 OP 玩家的 IP 都是回环地址</p><p>就出现了玩家登录 OP 账号等 “绕过登录漏洞”</p><h3 id="显示玩家-ip-归属地" tabindex="-1">显示玩家 IP 归属地 <a class="header-anchor" href="#显示玩家-ip-归属地" aria-label="Permalink to &quot;显示玩家 IP 归属地&quot;">​</a></h3><p>一些可以显示玩家 IP 归属地的插件会失效</p><p>因为他们的 IP 都是回环地址</p><h3 id="ban-ip-ban掉所有人" tabindex="-1">ban-ip ban掉所有人 <a class="header-anchor" href="#ban-ip-ban掉所有人" aria-label="Permalink to &quot;ban-ip ban掉所有人&quot;">​</a></h3><p>因为你们的地址都是回环地址</p><p>所以你 ban-ip 会 ban 掉所有人，包括你自己......</p><h3 id="反假人插件" tabindex="-1">反假人插件 <a class="header-anchor" href="#反假人插件" aria-label="Permalink to &quot;反假人插件&quot;">​</a></h3><p>这会导致反假人插件几乎不能使用，因为无论是封禁 IP 还是 IP 白名单都会因为所有玩家 IP 相同而失效。</p><h3 id="解决以上无法显示ip地址的办法-proxy-protocol" tabindex="-1">解决以上无法显示IP地址的办法：proxy protocol <a class="header-anchor" href="#解决以上无法显示ip地址的办法-proxy-protocol" aria-label="Permalink to &quot;解决以上无法显示IP地址的办法：proxy protocol&quot;">​</a></h3><p>正是因为frp在转发玩家请求时重写了请求头部，导致了以上情况的发生。 frp 虽然不能不重写这个请求头部，但是他可以通过一种方式还原请求头部，让服务器正常显示出连接 IP 。 Proxy Protocol 是由 HAProxy 开发者 Willy 提出的一种反向代理协议，可以参考 <a href="http://www.haproxy.org/download/1.8/doc/proxy-protocol.txt" target="_blank" rel="noreferrer">HAProxy 文档</a> 获取更多信息。frp 内置的 proxy protocol 要求被其穿透的服务器也支持 proxy protocol ，否则会造成对应的服务无法使用，所以并不是随便拿一个服务就能用 proxy protocol 。 frp 启用 proxy protocol 的方式参考 <a href="/advance/Linux/frp.html">Linux自建frp</a>。</p><p>对于mc服务器来说，支持 proxy protocol 的软件有：</p><ul><li>bungeecord 系</li><li>paper 分支(1.18.2)(仅支持v2)</li><li><a href="https://nitwikit.yizhan.wiki/Java/process/mobile-player/Geyser/introduction/FAQ/#frp%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%83%B3%E6%98%BE%E7%A4%BA%E7%9C%9F%E5%AE%9Eip%E6%80%8E%E4%B9%88%E5%8A%9E" target="_blank" rel="noreferrer">Geyser</a></li><li>Spigot端插件 <a href="https://github.com/andylizi/haproxy-detector" target="_blank" rel="noreferrer">HAProxyDetector</a></li></ul><p>等。BDS 服务器目前不支持此协议。</p>`,63)]))}const b=e(i,[["render",n]]);export{u as __pageData,b as default};
